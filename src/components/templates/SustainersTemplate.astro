---
import img from '@sanity/image-url';
import { sanityClient as sanity } from 'sanity:client';
import { toHTML } from '../../lib/portableTextSerializer';
import '../../styles/global.css';
import type { Campaign } from '../../pages/campaigns/campaignBySlug.groq';
import DonationThermometer from '../DonationThermometer.astro';
import SustainerStep from '../SustainerStep.astro';
import SustainerSection from '../SustainerSection.astro';
import FAQSection from '../FAQSection.tsx';
import FooterCTA from '../FooterCTA.tsx';
import Footer from '../Footer.astro';

interface Props {
  campaignData: Campaign;
}

const { campaignData } = Astro.props;

// Steps for the "How It Works" section
// Not connected to Sanity, hardcoded for now
const steps = [
  {
    step: 1,
    title: 'Choose Your Amount',
    description: 'Select a monthly donation amount that works for your budget.',
  },
  {
    step: 2,
    title: 'Sign Up Once',
    description: 'Enter your information and payment details just once.',
  },
  {
    step: 3,
    title: 'Make a Difference',
    description: 'Your donation automatically processes each month, creating ongoing impact.',
  }
];
---

<main class="flex min-h-screen flex-col">
  <!-- Debug Output -->
  <!-- <div class="debug p-4 bg-gray-100 border border-gray-300 m-4">
    <h3>Debug: Campaign Data</h3>
    <pre>{JSON.stringify(campaignData, null, 2)}</pre>
  </div> -->

  <!-- Hero section -->
  <section class="relative sus-primary-bg py-20 text-white">
    <div class="container mx-auto px-4 md:px-6">
      <div class="grid gap-6 lg:grid-cols-2 lg:gap-12">
        <div class="flex flex-col justify-center space-y-4">
          <div class="space-y-2 text-center lg:text-left">
            <h1
              class="text-balance text-5xl font-semibold tracking-tight sus-secondary-text sm:text-7xl uppercase rader-bold"
              set:html={toHTML(campaignData.heading)}
            />
            <div
              class="max-w-[600px] text-lg md:text-xl"
              set:html={toHTML(campaignData.heroCopy)}
            />
          </div>
          <div class="flex flex-col gap-2 min-[400px]:flex-row mx-auto lg:mx-0">
            <a
              href={campaignData.ctaLink}
              class="mt-8 px-6 py-2 bg-white sus-button-secondary-bg sus-button-secondary-hover border-2"
            >
              {campaignData.ctaText}
            </a>
            <a href="#" class="mt-8 px-6 py-2 border-white text-white hover:bg-white/20">
              Learn More
            </a>
          </div>
          <div class="space-y-2 pt-4">
            <DonationThermometer />
          </div>
        </div>
        <div class="flex items-center justify-center">
          <div class="overflow-hidden rounded-lg shadow-xl">
            <img
              src={campaignData.heroImage ? img(sanity).image(campaignData.heroImage).url() : ''}
              alt={campaignData.heroImageAlt || 'Hero image'}
              class="aspect-[4/3] object-cover"
            />
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Why Become a Sustainer? (Dynamic Template Section) -->
  {
    campaignData.sections?.length ? (
      campaignData.sections.map(
        (section) =>
          section._type === 'sustainerSection' && (
            <SustainerSection section={section} />
          ),
      )
    ) : (
      <section class="py-16 md:py-24">
        <div class="container mx-auto px-4 md:px-6">
          <p class="text-center text-gray-600">
            No sustainer section available. Please check Sanity data.
          </p>
        </div>
      </section>
    )
  }

  <!-- Donation Tiers -->
  <section class="bg-gray-50 py-16 md:py-24">
    <p class="text-center">Give form goes here.</p>
  </section>

  <!-- How It Works -->
  <section class="sus-accent-bg py-16 md:py-24 sus-primary-heading">
    <div class="container mx-auto px-4 md:px-6">
      <div class="mx-auto max-w-3xl text-center">
        <h2 class="text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl">How it Works</h2>
        <p class="mt-4 text-lg">Becoming a sustainer is simple:</p>
      </div>
      <div class="mt-12 grid gap-8 md:grid-cols-3">
        {steps.map(({ step, title, description }) => (
          <SustainerStep step={step} title={title} description={description} />
        ))}
      </div>
    </div>
  </section>

  <!-- FAQ Section (Dynamic) -->
  <FAQSection faqs={campaignData.faqs || []} />

  <!-- Footer CTA -->
  <FooterCTA />
</main>

<Footer />
