---
import type { Campaign } from '../../campaignBySlug.groq';
import { PortableText } from 'astro-portabletext';

interface Props {
  campaignData: Campaign;
}

const { campaignData } = Astro.props;
const faqs = campaignData.faqs || [];
---

<section class="bg-gradient-to-t from-[#ebebec] via-[#ebebec] to-white p-8">
  <div class="max-w-[1440px] my-0 mx-auto py-16 lg:py-20 lg:block">
    <div class="max-w-full lg:max-w-[65%] py-2 lg:pr-0">
      <div>
        <h2 class="text-4xl font-semibold tracking-tight text-gray-900 sm:text-5xl">
          Frequently Asked Questions
        </h2>
        <dl class="mt-16 divide-y divide-gray-900/10">
          {
            faqs.map((faq, index) => (
              <div class="py-6 first:pt-0 last:pb-0 faq-item">
                <dt>
                  <button
                    type="button"
                    aria-expanded="false"
                    aria-controls={`faq-answer-${index}`}
                    class="flex w-full items-start justify-between text-left text-gray-900 faq-button"
                  >
                    <span class="text-base/7 faq-question">{faq.question}</span>
                    <span class="ml-6 flex h-7 items-center">
                      <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="1.5"
                        data-slot="icon"
                        aria-hidden="true"
                        class="size-6 plus-icon"
                      >
                        <path d="M12 6v12m6-6H6" stroke-linecap="round" stroke-linejoin="round" />
                      </svg>
                      <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="1.5"
                        data-slot="icon"
                        aria-hidden="true"
                        class="size-6 minus-icon hidden"
                      >
                        <path d="M18 12H6" stroke-linecap="round" stroke-linejoin="round" />
                      </svg>
                    </span>
                  </button>
                </dt>
                <dd class="mt-2 pr-12 hidden" id={`faq-answer-${index}`}>
                  <div class="prose mt-4 faq-answer">
                    <PortableText value={faq.answer ?? []} />
                  </div>
                </dd>
              </div>
            ))
          }
        </dl>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const faqItems = document.querySelectorAll('.faq-item');

    faqItems.forEach((item) => {
      const button = item.querySelector<HTMLButtonElement>('.faq-button');
      const answer = item.querySelector<HTMLElement>('dd');
      const plusIcon = item.querySelector<HTMLElement>('.plus-icon');
      const minusIcon = item.querySelector<HTMLElement>('.minus-icon');

      if (!button || !answer || !plusIcon || !minusIcon) {
        return;
      }

      button.addEventListener('click', () => {
        const isExpanded = button.getAttribute('aria-expanded') === 'true';

        button.setAttribute('aria-expanded', String(!isExpanded));
        answer.classList.toggle('hidden');
        plusIcon.classList.toggle('hidden');
        minusIcon.classList.toggle('hidden');
      });
    });
  });
</script>
